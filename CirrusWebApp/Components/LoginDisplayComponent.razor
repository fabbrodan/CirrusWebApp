@using System.Security.Claims
@using Microsoft.AspNetCore.Http

@inject IHttpContextAccessor _httpContextAccessor

@if (User.Identity.Name != null)
{
<div class="float-right pr-5">
    <b class="pr-2">@Firstname @Lastname</b>
    @if (Avatar != null)
    {
        <img style="width: 15px; height: 15px;" src="@Avatar" />
    }
    <AuthorizeView>
        <Authorized>
            <a href="/LogoutCall">Sign Out</a>
        </Authorized>
    </AuthorizeView>
</div>
}

@code {

    private ClaimsPrincipal User;
    private string Firstname;
    private string Lastname;
    private string Avatar;

    protected override void OnInitialized()
    {
        try
        {
            User = _httpContextAccessor.HttpContext.User == null ? null : _httpContextAccessor.HttpContext.User;
            if (User != null)
            {
                Firstname = User.FindFirst(ClaimTypes.GivenName) == null ? "" : User.FindFirst(ClaimTypes.GivenName).Value;
                Lastname = User.FindFirst(ClaimTypes.Surname) == null ? "" : User.FindFirst(ClaimTypes.Surname).Value;
                Avatar = User.FindFirst("urn:google:image") == null ? null : User.FindFirst("urn:google:image").Value;
            }

            base.OnInitialized();
        }
        catch (NullReferenceException exc)
        {
            Console.WriteLine(_httpContextAccessor.HttpContext.User);
            Console.WriteLine(exc.Message);
        }
    }
}
